(function(undefined){"use strict";var slice=Array.prototype.slice,isArray=Array.isArray,isDictionary=function(object){return"object"==typeof object&&object.constructor===Object},_ver="${VERSION}",_sys=null,_constructors={},_factories={},_envtype=function(){return"undefined"!=typeof module&&module.exports?"node":"undefined"!=typeof window?"browser":"unknown"}(),timbre=function(){var instance,args=slice.call(arguments),key=args[0];switch(typeof key){case"string":_constructors[key]?instance=new _constructors[key](args.slice(1)):_factories[key]?instance=_factories[key](args.slice(1)):console.warn('T("'+key+'") is not defined.');break;case"number":instance=new NumberWrapper(args);break;case"boolean":instance=new BooleanWrapper(args);break;case"function":instance=new FunctionWrapper(args);break;case"object":if(null!==key){if(key instanceof TimbreObject)return key;key.constructor===Object?instance=new ObjectWrapper(args):isArray(key)&&(instance=new ArrayWrapper(args))}}return instance===undefined?(instance=new NumberWrapper([0]),instance._.isUndefined=!0):instance._.isUndefined=!1,instance.isStereo===undefined&&Object.defineProperty(instance,"isStereo",{value:!1,configurable:!1}),instance.emit("init"),instance};timbre.fn={},timbre.utils={},Object.defineProperties(timbre,{version:{get:function(){return _ver}},envtype:{get:function(){return _envtype}},env:{get:function(){return _sys.impl.env}},samplerate:{get:function(){return _sys.samplerate}},channels:{get:function(){return _sys.channels}},cellsize:{get:function(){return _sys.cellsize}},currentTime:{get:function(){return _sys.currentTime}},isPlaying:{get:function(){return _sys.isPlaying}},amp:{set:function(value){"number"==typeof value&&(_sys.amp=value)},get:function(){return _sys.amp}}}),timbre.bind=function(Klass,opts){return _sys.bind(Klass,opts),timbre},timbre.play=function(){return _sys.play(),timbre},timbre.pause=function(){return _sys.pause(),timbre},timbre.reset=function(){return _sys.reset(),timbre},timbre.on=function(type,listener){return _sys.on(type,listener),timbre},timbre.addListener=timbre.on,timbre.once=function(type,listener){return _sys.once(type,listener),timbre},timbre.removeListener=function(type,listener){return _sys.removeListener(type,listener),timbre},timbre.removeAllListeners=function(type){return _sys.removeAllListeners(type),timbre},timbre.listeners=function(type){return _sys.listeners(type)},timbre.nextTick=function(func){return _sys.nextTick(func),timbre};var __extend=function(child,parent){function Ctor(){this.constructor=child}for(var key in parent)parent.hasOwnProperty(key)&&(child[key]=parent[key]);return Ctor.prototype=parent.prototype,child.prototype=new Ctor,child.__super__=parent.prototype,child};timbre.fn.extend=__extend;var __constructorof=function(ctor,Klass){for(var f=ctor&&ctor.prototype;f;){if(f===Klass.prototype)return!0;f=Object.getPrototypeOf(f)}return!1};timbre.fn.constructorof=__constructorof;var __register=function(key,ctor){__constructorof(ctor,TimbreObject)?_constructors[key]=ctor:_factories[key]=ctor};timbre.fn.register=__register;var __alias=function(key,alias){_constructors[alias]?_constructors[key]=_constructors[alias]:_factories[alias]&&(_factories[key]=_factories[alias])};timbre.fn.alias=__alias;var __getClass=function(key){return _constructors[key]};timbre.fn.getClass=__getClass;var __fixAR=function(){var f=function(){this._.ar=!0};return Object.defineProperty(f,"unremovable",{value:!0,configurable:!1}),function(object){object._.ar=!0,object.on("ar",f)}}();timbre.fn.fixAR=__fixAR;var __fixKR=function(){var f=function(){this._.ar=!1};return Object.defineProperty(f,"unremovable",{value:!0,configurable:!1}),function(object){object._.ar=!1,object.on("ar",f)}}();timbre.fn.fixKR=__fixKR;var EventEmitter=function(){function EventEmitter(){this._||(this._={})}var $=EventEmitter.prototype;return $.emit=function(type){var _=this._;if(!_.events)return!1;var handler=_.events[type];if(!handler)return!1;var args;if("function"==typeof handler){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=slice.call(arguments,1),handler.apply(this,args)}return!0}if(isArray(handler)){args=slice.call(arguments,1);for(var listeners=handler.slice(),i=0,imax=listeners.length;imax>i;++i)listeners[i].apply(this,args);return!0}return!1},$.addListener=function(type,listener){if("function"!=typeof listener)throw Error("addListener only takes instances of Function");var _=this._;return _.events||(_.events={}),_.events[type]?isArray(_.events[type])?_.events[type].push(listener):_.events[type]=[_.events[type],listener]:_.events[type]=listener,this},$.on=$.addListener,$.once=function(type,listener){function g(){self.removeListener(type,g),listener.apply(self,arguments)}if("function"!=typeof listener)throw Error("once only takes instances of Function");var self=this;return g.listener=listener,self.on(type,g),this},$.removeListener=function(type,listener){if("function"!=typeof listener)throw Error("removeListener only takes instances of Function");var _=this._;if(!_.events||!_.events[type])return this;var list=_.events[type];if(isArray(list)){for(var position=-1,i=0,imax=list.length;imax>i;++i)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;list.splice(position,1),0===list.length&&(_.events[type]=null)}else(list===listener||list.listener&&list.listener===listener)&&(_.events[type]=null);return this},$.removeAllListeners=function(type){var _=this._;if(!_.events)return this;var remain=!1,listeners=_.events[type];if(isArray(listeners))for(var i=listeners.length;i--;){var listener=listeners[i];listener.unremovable?remain=!0:this.removeListener(type,listener)}else listeners&&(listeners.unremovable?remain=!0:this.removeListener(type,listeners));return remain||(_.events[type]=null),this},$.listeners=function(type){var _=this._;return _.events&&_.events[type]?isArray(_.events[type])?_.events[type].slice():[_.events[type]]:[]},EventEmitter}(),TimbreObject=function(){function TimbreObject(_args){if(this._={},isDictionary(_args[0])){var params=_args.shift();this.once("init",function(){this.set(params)})}this.seq_id=-1,this.cell=new Float32Array(_sys.cellsize),this.inputs=_args.map(timbre),this._.ar=!0,this._.mul=1,this._.add=0,this._.dac=null}__extend(TimbreObject,EventEmitter);var $=TimbreObject.prototype;return Object.defineProperties($,{isUndefined:{get:function(){return this._.isUndefined}},isAr:{get:function(){return this._.ar}},isKr:{get:function(){return!this._.ar}},mul:{set:function(value){"number"==typeof value&&(this._.mul=value,this.emit("setMul",value))},get:function(){return this._.mul}},add:{set:function(value){"number"==typeof value&&(this._.add=value,this.emit("setAdd",value))},get:function(){return this._.add}},dac:{set:function(value){var _=this._;value instanceof SystemInlet&&_.dac!==value&&(_.dac&&_.dac.remove(this),value.append(this))},get:function(){return this._.dac}}}),$.toString=function(){return this.constructor.name},$.valueOf=function(){return _sys.seq_id!==this.seq_id&&this.seq(_sys.seq_id),this.cell[0]},$.append=function(){if(arguments.length>0){var list=slice.call(arguments);this.inputs=this.inputs.concat(list),this.emit("append",list)}return this},$.appendTo=function(object){return object.append(this),this},$.remove=function(){if(arguments.length>0){for(var j,inputs=this.inputs,list=[],i=0,imax=arguments.length;imax>i;++i)-1!==(j=inputs.indexOf(arguments[i]))&&(list.push(inputs[j]),inputs.splice(j,1));list.length>0&&this.emit("remove",list)}return this},$.removeFrom=function(object){return object.remove(this),this},$.removeAll=function(){var list=this.inputs.slice();return this.inputs=[],list.length>0&&this.emit("remove",list),this},$.removeAtIndex=function(index){var item=this.inputs[index];return item&&(this.inputs.splice(index,1),this.emit("remove",[item])),this},$.set=function(key,value){var x,desc;switch(typeof key){case"string":for(x=Object.getPrototypeOf(this);null!==x;){if((desc=Object.getOwnPropertyDescriptor(x,key))!==undefined){desc.configurable||(this[key]=value);break}x=Object.getPrototypeOf(x)}break;case"object":for(x in key)this.set(x,key[x])}return this},$.get=function(key){for(var x=Object.getPrototypeOf(this);null!==x;){if(Object.getOwnPropertyDescriptor(x,key)!==undefined)return this[key];x=Object.getPrototypeOf(x)}},$.bang=function(){return this.emit("bang"),this},$.seq=function(){return this.cell},$.play=function(){var dac=this._.dac,emit=!1;return null===dac?(dac=this._.dac=new SystemInlet(this),emit=!0):-1===dac.inputs.indexOf(this)&&(dac.append(this),emit=!0),dac.play(),emit&&this.emit("play"),this},$.pause=function(){var dac=this._.dac;return dac&&(-1!==dac.inputs.indexOf(this)&&(dac.remove(this),this.emit("pause")),0===dac.inputs.length&&dac.pause()),this},$.ar=function(){return this._.ar=!0,this.emit("ar",!0),this},$.kr=function(){return this._.ar=!1,this.emit("ar",!1),this},$.plot="browser"===_envtype?function(opts){var _=this._,canvas=opts.target;if(!canvas)return this;var foreground,width=opts.width||canvas.width||320,height=opts.height||canvas.height||240,offset_x=(opts.x||0)+.5,offset_y=opts.y||0,context=canvas.getContext("2d");foreground=opts.foreground!==undefined?opts.foreground:_.plotForeground||"rgb(  0, 128, 255)";var background;background=opts.background!==undefined?opts.background:_.plotBackground||"rgb(255, 255, 255)";var x,y,dy,y0,i,lineWidth=opts.lineWidth||_.plotLineWidth||1,cyclic=!!_.plotCyclic,data=_.plotData||this.cell,range=opts.range||_.plotRange||[-1.2,1.2],rangeMin=range[0],rangeDelta=height/(range[1]-rangeMin),dx=width/data.length,imax=data.length;if(context.save(),context.rect(offset_x,offset_y,width+1,height),context.clip(),null!==background&&(context.fillStyle=background,context.fillRect(offset_x,offset_y,width,height)),_.plotBefore&&_.plotBefore.call(this,context,offset_x,offset_y,width,height),_.plotBarStyle)for(context.fillStyle=foreground,x=0,i=0;imax>i;++i)dy=(data[i]-rangeMin)*rangeDelta,y=height-dy,context.fillRect(x+offset_x,y+offset_y,dx,dy),x+=dx;else{for(context.strokeStyle=foreground,context.lineWidth=lineWidth,context.beginPath(),x=0,y0=height-(data[0]-rangeMin)*rangeDelta,context.moveTo(x+offset_x,y0+offset_y),i=1;imax>i;++i)x+=dx,y=height-(data[i]-rangeMin)*rangeDelta,context.lineTo(x+offset_x,y+offset_y);cyclic?context.lineTo(x+dx+offset_x,y0+offset_y):context.lineTo(x+dx+offset_x,y+offset_y),context.stroke()}_.plotAfter&&_.plotAfter.call(this,context,offset_x,offset_y,width,height);var border=opts.border||_.plotBorder;return border&&(context.strokeStyle="string"==typeof border?border:"#000",context.lineWidth=1,context.strokeRect(offset_x,offset_y,width,height)),context.restore(),this}:function(){},TimbreObject}();timbre.Object=TimbreObject;var TimbreStereoObject=function(){function TimbreStereoObject(_args){TimbreObject.call(this,_args),this.L=new TimbreObject([]),this.R=new TimbreObject([]),this.cellL=this.L.cell,this.cellR=this.R.cell,Object.defineProperty(this,"isStereo",{value:!0,configurate:!1})}return __extend(TimbreStereoObject,TimbreObject),TimbreStereoObject}();timbre.StereoObject=TimbreStereoObject;var TimbreTimerObject=function(){function TimbreTimerObject(_args){TimbreObject.call(this,_args)}__extend(TimbreTimerObject,TimbreObject);var $=TimbreTimerObject.prototype;return $.start=function(){var self=this;return _sys.nextTick(function(){return self._.remove_check?self._.remove_check=null:(-1===_sys.timers.indexOf(self)&&(_sys.timers.push(self),_sys.emit("addObject"),self.emit("start")),undefined)}),this},$.stop=function(){return this._.remove_check=!0,-1!==_sys.timers.indexOf(this)&&(_sys.nextTick(function(){_sys.emit("removeObject")}),this.emit("stop")),this},$.play=$.pause=function(){return this},TimbreTimerObject}();timbre.TimerObject=TimbreTimerObject;var TimbreListenerObject=function(){function TimbreListenerObject(_args){TimbreObject.call(this,_args)}__extend(TimbreListenerObject,TimbreObject);var $=TimbreListenerObject.prototype;return $.listen=function(target){var self=this;return null===target?(this._.remove_check=!0,-1!==_sys.listeners.indexOf(this)&&_sys.nextTick(function(){_sys.emit("removeObject")})):target instanceof TimbreObject&&_sys.nextTick(function(){return self._.remove_check?self._.remove_check=null:(-1===_sys.listeners.indexOf(self)&&(self._.inputs=self.inputs,self.inputs=[target],_sys.listeners.push(self),_sys.emit("addObject")),undefined)}),this.emit("listen",target),this},$.play=$.pause=function(){return this},TimbreListenerObject}();timbre.ListenerObject=TimbreListenerObject;var NumberWrapper=function(){function NumberWrapper(_args){TimbreObject.call(this,[]),this.value=_args[0],this._.ar=!1,this.on("setAdd",changeTheValue),this.on("setMul",changeTheValue),__fixKR(this)}__extend(NumberWrapper,TimbreObject);var changeTheValue=function(){for(var _=this._,x=_.value*_.mul+_.add,cell=this.cell,i=cell.length;i--;)cell[i]=x};Object.defineProperty(changeTheValue,"unremovable",{value:!0,configurable:!1});var $=NumberWrapper.prototype;return Object.defineProperties($,{value:{set:function(value){"number"==typeof value&&(this._.value=isNaN(value)?0:value,changeTheValue.call(this))},get:function(){return this._.value}}}),NumberWrapper}(),BooleanWrapper=function(){function BooleanWrapper(_args){TimbreObject.call(this,[]),this.value=_args[0],this._.ar=!1,this.on("setAdd",changeTheValue),this.on("setMul",changeTheValue),__fixKR(this)}__extend(BooleanWrapper,TimbreObject);var changeTheValue=function(){for(var _=this._,x=_.value*_.mul+_.add,cell=this.cell,i=cell.length;i--;)cell[i]=x};Object.defineProperty(changeTheValue,"unremovable",{value:!0,configurable:!1});var $=BooleanWrapper.prototype;return Object.defineProperties($,{value:{set:function(value){"number"==typeof value&&(this._.value=value?1:0,changeTheValue.call(this))},get:function(){return!!this._.value}}}),BooleanWrapper}(),FunctionWrapper=function(){function FunctionWrapper(_args){TimbreObject.call(this,[]),this.value=_args[0],this._.args=_args.slice(1),this._.ar=!1,__fixKR(this)}__extend(FunctionWrapper,TimbreObject);var $=FunctionWrapper.prototype;return Object.defineProperties($,{value:{set:function(value){"function"==typeof value&&(this._.value=value)},get:function(){return this._.value}},args:{set:function(value){this._.args=isArray(value)?value:[value]},get:function(){return this._.args}}}),$.bang=function(){return this._.value.apply(null,this._.args),this.emit("bang"),this},FunctionWrapper}(),ArrayWrapper=function(){function ArrayWrapper(){TimbreObject.call(this,[])}return __extend(ArrayWrapper,TimbreObject),ArrayWrapper}(),ObjectWrapper=function(){function ObjectWrapper(){TimbreObject.call(this,[])}return __extend(ObjectWrapper,TimbreObject),ObjectWrapper}(),SystemInlet=function(){function SystemInlet(object){TimbreStereoObject.call(this,[]),this.inputs.push(object),this.on("append",onappend)}__extend(SystemInlet,TimbreStereoObject);var onappend=function(list){for(var i=list.length;i--;)list[i]._.dac=this};Object.defineProperty(onappend,"unremovable",{value:!0,configurable:!1});var $=SystemInlet.prototype;return Object.defineProperties($,{dac:{set:function(){},get:function(){return this}}}),$.play=function(){var self=this;return _sys.nextTick(function(){-1===_sys.inlets.indexOf(self)&&(_sys.inlets.push(self),_sys.emit("addObject"),self.emit("play"))}),this},$.pause=function(){return-1!==_sys.inlets.indexOf(this)&&(this._.remove_check=!0,_sys.nextTick(function(){_sys.emit("removeObject")}),this.emit("pause")),this},$.seq=function(seq_id){var i,j,tmp,tmpL,tmpR,x,_=this._,cell=this.cell,cellL=this.cellL,cellR=this.cellR,inputs=this.inputs,imax=inputs.length,jmax=cell.length,add=_.add,mul=_.mul;if(this.seq_id!==seq_id){for(this.seq_id=seq_id,j=jmax;j--;)cellL[j]=cellR[j]=cell[j]=0;for(i=0;imax>i;++i)for(tmp=inputs[i],tmp.seq(seq_id),tmp.isStereo?(tmpL=tmp.cellL,tmpR=tmp.cellR):tmpL=tmpR=tmp.cell,j=jmax;j--;)cellL[j]+=tmpL[j],cellR[j]+=tmpR[j];for(j=jmax;j--;)x=cellL[j]=cellL[j]*mul+add,x+=cellR[j]=cellR[j]*mul+add,cell[j]=.5*x}return cell},SystemInlet}(),SoundSystem=function(){function SoundSystem(){this._={},this.seq_id=0,this.impl=null,this.amp=.8,this.isPlaying=!1,this.samplerate=44100,this.channels=2,this.cellsize=128,this.streammsec=20,this.streamsize=0,this.currentTime=0,this.currentTimeIncr=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this.on("addObject",function(){this.isPlaying||(this.inlets.length>0||this.timers.length>0)&&this.play()}),this.on("removeObject",function(){this.isPlaying&&0===this.inlets.length&&0===this.timers.length&&this.pause()})}__extend(SoundSystem,EventEmitter);var ACCEPT_SAMPLERATES=[8e3,11025,12e3,16e3,22050,24e3,32e3,44100,48e3],ACCEPT_CELLSIZES=[32,64,128,256],$=SoundSystem.prototype;return $.bind=function(Klass,opts){if("function"==typeof Klass){var player=new Klass(this,opts);"function"==typeof player.play&&"function"==typeof player.pause&&(this.impl=player,this.impl.defaultSamplerate&&(this.sampleRate=this.impl.defaultSamplerate))}return this},$.setup=function(params){return"object"==typeof params&&(-1!==ACCEPT_SAMPLERATES.indexOf(params.samplerate)&&(this.samplerate=params.samplerate<=this.impl.maxSamplerate?params.samplerate:this.impl.maxSamplerate),-1!==ACCEPT_CELLSIZES.indexOf(params.cellsize)&&(this.cellsize=params.cellsize)),this},$.getAdjustSamples=function(samplerate){var samples,bits;return samplerate=samplerate||this.samplerate,samples=this.streammsec/1e3*samplerate,bits=Math.ceil(Math.log(samples)*Math.LOG2E),bits=8>bits?8:bits>14?14:bits,1<<bits},$.play=function(){return this.isPlaying||(this.isPlaying=!0,this.currentTimeIncr=1e3*this.cellsize/this.samplerate,this.streamsize=this.getAdjustSamples(),this.strmL=new Float32Array(this.streamsize),this.strmR=new Float32Array(this.streamsize),this.impl.play(),this.emit("play")),this},$.pause=function(){return this.isPlaying&&(this.isPlaying=!1,this.impl.pause(),this.emit("pause")),this},$.reset=function(){return this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this},$.process=function(){var x,tmpL,tmpR,i,j,jmax,k,nextTicks,seq_id=this.seq_id,strmL=this.strmL,strmR=this.strmR,amp=this.amp,imax=this.streamsize,saved_i=0,kmax=this.cellsize,n=this.streamsize/this.cellsize,timers=this.timers,inlets=this.inlets,listeners=this.listeners,currentTimeIncr=this.currentTimeIncr;for(i=imax;i--;)strmL[i]=strmR[i]=0;for(;n--;){for(++seq_id,j=0,jmax=timers.length;jmax>j;++j)timers[j].seq(seq_id);for(j=0,jmax=inlets.length;jmax>j;++j)for(x=inlets[j],x.seq(seq_id),tmpL=x.cellL,tmpR=x.cellR,k=0,i=saved_i;kmax>k;++k,++i)strmL[i]+=tmpL[k],strmR[i]+=tmpR[k];for(saved_i=i,j=0,jmax=listeners.length;jmax>j;++j)listeners[j].seq(seq_id);for(j=timers.length;j--;)timers[j]._.remove_check&&(timers[j]._.remove_check=null,timers.splice(j,1));for(j=inlets.length;j--;)inlets[j]._.remove_check&&(inlets[j]._.remove_check=null,inlets.splice(j,1));for(j=listeners.length;j--;)listeners[j]._.remove_check&&(listeners[j]._.remove_check=null,listeners.splice(j,1));for(this.currentTime+=currentTimeIncr,nextTicks=this.nextTicks.splice(0),j=0,jmax=nextTicks.length;jmax>j;++j)nextTicks[j].call(null)}for(i=imax;i--;)x=strmL[i]*amp,x=-1>x?-1:x>1?1:x,strmL[i]=x,x=strmR[i]*amp,x=-1>x?-1:x>1?1:x,strmR[i]=x;this.seq_id=seq_id},$.nextTick=function(func){this.isPlaying?this.nextTicks.push(func):func()},SoundSystem}(),ImplClass=null;ImplClass="undefined"!=typeof webkitAudioContext?function(sys){var bufSrc,jsNode,context=new webkitAudioContext;this.maxSamplerate=context.sampleRate,this.defaultSamplerate=context.sampleRate,this.env="webkit",this.play=function(){var onaudioprocess,sys_streamsize,x,dx,jsn_streamsize=sys.getAdjustSamples(context.sampleRate);sys.samplerate===context.sampleRate?onaudioprocess=function(e){var inL=sys.strmL,inR=sys.strmR,outL=e.outputBuffer.getChannelData(0),outR=e.outputBuffer.getChannelData(1),i=outL.length;for(sys.process();i--;)outL[i]=inL[i],outR[i]=inR[i]}:(sys_streamsize=sys.streamsize,x=sys_streamsize,dx=sys.samplerate/context.sampleRate,onaudioprocess=function(e){var i,inL=sys.strmL,inR=sys.strmR,outL=e.outputBuffer.getChannelData(0),outR=e.outputBuffer.getChannelData(1),imax=outL.length;for(i=0;imax>i;++i)x>=sys_streamsize&&(sys.process(),x-=sys_streamsize),outL[i]=inL[0|x],outR[i]=inR[0|x],x+=dx}),bufSrc=context.createBufferSource(),jsNode=context.createJavaScriptNode(jsn_streamsize,2,sys.channels),jsNode.onaudioprocess=onaudioprocess,bufSrc.noteOn(0),bufSrc.connect(jsNode),jsNode.connect(context.destination)},this.pause=function(){bufSrc.disconnect(),jsNode.disconnect()}}:"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?function(sys){var timer=function(){var source="var t=0;onmessage=function(e){if(t)t=clearInterval(t),0;if(typeof e.data=='number'&&e.data>0)t=setInterval(function(){postMessage(0);},e.data);};",blob=new Blob([source],{type:"text/javascript"}),path=URL.createObjectURL(blob);return new Worker(path)}();this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="moz",this.play=function(){var onaudioprocess,audio=new Audio,interleaved=new Float32Array(sys.streamsize*sys.channels),interval=1e3*(sys.streamsize/sys.samplerate);onaudioprocess=function(){var inL=sys.strmL,inR=sys.strmR,i=interleaved.length,j=inL.length;for(sys.process();j--;)interleaved[--i]=inR[j],interleaved[--i]=inL[j];audio.mozWriteAudio(interleaved)},audio.mozSetup(sys.channels,sys.samplerate),timer.onmessage=onaudioprocess,timer.postMessage(interval)},this.pause=function(){timer.postMessage(0)}}:function(){this.maxSamplerate=48e3,this.defaultSamplerate=8e3,this.env="nop",this.play=function(){},this.pause=function(){}},_sys=(new SoundSystem).bind(ImplClass);var exports=timbre;"node"===_envtype?module.exports=global.timbre=exports:"browser"===_envtype&&(window.Float32Array===undefined&&(window.Float32Array=Array),exports.noConflict=function(){var _t=window.timbre,_T=window.T;return function(deep){return window.T===exports&&(window.T=_T),deep&&window.timbre===exports&&(window.timbre=_t),exports}}(),window.timbre=window.T=exports)})(),function(timbre){"use strict";function Add(_args){timbre.Object.call(this,_args)}timbre.fn.extend(Add,timbre.Object);var $=Add.prototype;$.seq=function(seq_id){var cell=this.cell,_=this._;if(this.seq_id!==seq_id){this.seq_id=seq_id;var i,j,tmp,inputs=this.inputs,mul=_.mul,add=_.add,imax=inputs.length,jmax=cell.length;for(j=jmax;j--;)cell[j]=0;if(_.ar){for(i=0;imax>i;++i)for(tmp=inputs[i].seq(seq_id),j=jmax;j--;)cell[j]+=tmp[j];if(1!==mul||0!==add)for(j=jmax;j--;)cell[j]=cell[j]*mul+add}else{for(tmp=0,i=0;imax>i;++i)tmp+=inputs[i].seq(seq_id)[0];for(tmp=tmp*mul+add,j=jmax;j--;)cell[j]=tmp}}return cell},timbre.fn.register("+",Add)}(timbre),function(timbre){"use strict";function AudioFile(_args){timbre.Object.call(this,_args),this._.isLooped=!1,this._.isReversed=!1,this._.isLoaded=!1,this._.isEnded=!0,this._.duration=0,this._.loadedTime=0,this._.currentTime=0,this._.currentTimeIncr=1e3*this.cell/timbre.samplerate,timbre.fn.fixAR(this)}timbre.fn.extend(AudioFile,timbre.Object);var $=AudioFile.prototype;Object.defineProperties($,{src:{set:function(value){var _=this._;_.value!==value&&("string"==typeof value?(this._.src=value,this._.isLoaded=!1):"browser"===timbre.envtype&&value instanceof File&&(this._.src=value,this._.isLoaded=!1))},get:function(){return this._.src}},isLooped:{set:function(value){this._.isLooped=!!value},get:function(){return this._.isLooped}},isReversed:{set:function(value){var _=this._;_.isReversed=!!value,_.isReversed?(_.phaseIncr>0&&(_.phaseIncr*=-1),0===_.phase&&(_.phase=_.buffer.length+_.phaseIncr)):0>_.phaseIncr&&(_.phaseIncr*=-1)},get:function(){return this._.isReversed}},isLoaded:{get:function(){return this._.isLoaded}},isEnded:{get:function(){return this._.isEnded}},duration:{get:function(){return this._.duration}},loadedTime:{get:function(){return this._.loadedTime}},currentTime:{set:function(value){if("number"==typeof value){var _=this._;value>=0&&_.duration>=value&&(_.phase=value/1e3*_.samplerate,_.currentTime=value)}},get:function(){return this._.currentTime}}}),$.bang=function(){return this._.phase=0,this._.isEnded=!1,this.emit("bang"),this},$.slice=function(begin,end){var _=this._,instance=timbre("audio"),isReversed=_.isReversed;if(begin="number"==typeof begin?0|.001*begin*_.samplerate:0,end="number"==typeof end?0|.001*end*_.samplerate:_.buffer.length,begin>end){var tmp=begin;begin=end,end=tmp,isReversed=!isReversed}return instance._.samplerate=_.samplerate,instance._.buffer=_.buffer.subarray(begin,end),instance._.duration=1e3*(end-begin/_.samplerate),instance.isLooped=this.isLooped,instance.isReversed=this.isReversed,instance},$.seq=function(seq_id){var _=this._,cell=this.cell;if(this.seq_id!==seq_id&&(this.seq_id=seq_id,!_.isEnded&&_.buffer)){for(var buffer=_.buffer,phase=_.phase,phaseIncr=_.phaseIncr,mul=_.mul,add=_.add,i=0,imax=cell.length;imax>i;++i)cell[i]=(buffer[0|phase]||0)*mul+add,phase+=phaseIncr;phase>=buffer.length?_.isLooped?(phase=0,this.emit("looped")):(_.isEnded=!0,this.emit("ended")):0>phase&&(_.isLooped?(phase=buffer.length+phaseIncr,this.emit("looped")):(_.isEnded=!0,this.emit("ended"))),_.phase=phase,_.currentTime+=_.currentTimeIncr}return cell},$.plot=function(opts){var _=this._,buffer=_.buffer;if(_.plotFlush){for(var data=new Float32Array(2048),x=0,xIncr=buffer.length/2048,i=0;2048>i;i++)data[i]=buffer[0|x],x+=xIncr;_.plotData=data,_.plotFlush=null}return AudioFile.__super__.plot.call(this,opts)};var deinterleave=function(list){var result=new list.constructor(list.length>>1),i=list.length,j=result.length;for(i%2&&(i-=1,j|=0);j;)result[--j]=.5*(list[--i]+list[--i]);return result},_24bit_to_32bit=function(uint8){for(var b0,b1,b2,bb,x,int32=new Int32Array(uint8.length/3),i=0,imax=uint8.length,j=0;imax>i;)b0=uint8[i++],b1=uint8[i++],b2=uint8[i++],bb=b0+(b1<<8)+(b2<<16),x=8388608&bb?-((16777215^bb)+1):bb,int32[j++]=x;return int32};"browser"===timbre.envtype?function(){$.load=function(){var self=this,_=this._,args=arguments,i=0,callback=function(){};if("string"==typeof args[i]?_.src=args[i++]:args[i]instanceof File&&(_.src=args[i++]),"function"==typeof args[i]&&(callback=args[i++]),!_.src)return callback.call(this,!1),this;_.loadedTime=0;var decoderList,src=_.src;if("string"==typeof src)if(""!==src){var noUseByteData=!1;if(/.*\.wav/.test(src)?decoderList=[wav_decoder]:webkit_decoder?decoderList=[webkit_decoder]:moz_decoder&&(decoderList=[moz_decoder],noUseByteData=!0),noUseByteData)then.call(this,decoderList,src,callback),this.emit("loadstart");else{var xhr=new XMLHttpRequest;xhr.open("GET",src,!0),xhr.responseType="arraybuffer",xhr.onload=function(){if(200===xhr.status)then.call(self,decoderList,new Uint8Array(xhr.response),callback);else{var msg=xhr.status+" "+xhr.statusText;self.emit("error",msg),callback.call(self,!1)}},xhr.send(),this.emit("loadstart")}}else callback.call(this,!1);else if(src instanceof File){var reader=new FileReader;reader.onload=function(){then.call(this,null,new Uint8Array(xhr.response),callback)},reader.readAsArrayBuffer(src),this.emit("loadstart")}return this}}():"node"===timbre.envtype&&function(){var fs=require("fs");$.load=function(){var self=this,_=this._,args=arguments,i=0,callback=function(){};if("string"==typeof args[i]?_.src=args[i++]:args[i]instanceof Buffer&&(_.src=args[i++]),"function"==typeof args[i]&&(callback=args[i++]),!_.src)return this;_.loadedTime=0;var src=_.src;return"string"==typeof src?(fs.exists(src,function(exists){if(!exists){var msg="file does not exists";return self.emit("error",msg),callback.call(self,!1)}/.*\.ogg/.test(src)?then.call(self,[node_ogg_decoder],src,callback):/.*\.mp3/.test(src)?then.call(self,[node_mp3_decoder],src,callback):fs.readFile(src,function(err,data){if(err){var msg="can't read file";return self.emit("error",msg),callback.call(self,!1)}var decoderList;"string"==typeof src&&/.*\.wav/.test(src)&&(decoderList=[wav_decoder]),then.call(self,decoderList,new Uint8Array(data),callback)})}),this.emit("loadstart")):src instanceof Buffer&&(then.call(this,null,new Uint8Array(src),callback),this.emit("loadstart")),this};var node_ogg_decoder=function(filepath,done){done(!1)},node_mp3_decoder=function(filepath,done){var samplerate,duration,buffer,channels,bitDepth,lame=require("lame"),self=this,decoder=new lame.Decoder,bytes=[];decoder.on("format",function(format){samplerate=format.sampleRate,channels=format.channels,bitDepth=format.bitDepth}),decoder.on("data",function(data){for(var i=0,imax=data.length;imax>i;++i)bytes.push(data[i])}),decoder.on("end",function(){var length=bytes.length/channels/(bitDepth/8);duration=length/samplerate,buffer=new Float32Array(length);var data,uint8=new Uint8Array(bytes);16===bitDepth?data=new Int16Array(uint8.buffer):8===bitDepth?data=new Int8Array(uint8.buffer):24===bitDepth&&(data=_24bit_to_32bit(uint8.buffer)),2===channels&&(data=deinterleave(data));for(var k=1/((1<<bitDepth-1)-1),i=buffer.length;i--;)buffer[i]=data[i]*k;done({samplerate:samplerate,buffer:buffer,duration:duration}),self._.isLoaded=!0,self._.plotFlush=!0,self.emit("loadeddata")}),fs.createReadStream(filepath).pipe(decoder)}}();var then=function(decoderList,data,callback){var self=this;if(!decoderList)return callback.call(self,!1);var done=function(result){var _=self._;result?(_.samplerate=result.samplerate,_.buffer=result.buffer,_.phase=0,_.phaseIncr=result.samplerate/timbre.samplerate,_.duration=1e3*result.duration,_.loadedTime=_.duration,_.isEnded=!1,_.currentTime=0,_.isReversed&&(_.phaseIncr*=-1,_.phase=result.buffer.length+_.phaseIncr),callback.call(self,!0),self.emit("loadedmetadata")):iter()},iter=function(){if(decoderList.length>0){var decoder=decoderList.shift();decoder?decoder.call(self,data,done):iter()}else self.emit("error","can't decode"),callback.call(self,!1)};iter()},webkit_decoder=function(){if("undefined"!=typeof webkitAudioContext){var ctx=new webkitAudioContext;return function(data,done){var samplerate,duration,buffer;try{buffer=ctx.createBuffer(data.buffer,!0)}catch(e){return done(!1)}samplerate=ctx.sampleRate,buffer=buffer.getChannelData(0),duration=buffer.length/samplerate,done({samplerate:samplerate,buffer:buffer,duration:duration}),this._.isLoaded=!0,this._.plotFlush=!0,this.emit("loadeddata")}}}(),moz_decoder=function(){return"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?function(data,done){var samplerate,duration,buffer,self=this,writeIndex=0,audio=new Audio(data);audio.volume=0,audio.speed=2,audio.addEventListener("loadedmetadata",function(){samplerate=audio.mozSampleRate,duration=audio.duration,buffer=new Float32Array(0|audio.duration*samplerate),2===audio.mozChannels?audio.addEventListener("MozAudioAvailable",function(e){for(var samples=e.frameBuffer,i=0,imax=samples.length;imax>i;i+=2)buffer[writeIndex++]=.5*(samples[i]+samples[i+1]);self._.loadedTime=1e3*samples.length/samplerate},!1):audio.addEventListener("MozAudioAvailable",function(e){for(var samples=e.frameBuffer,i=0,imax=samples.length;imax>i;++i)buffer[writeIndex++]=samples[i];self._.loadedTime=1e3*samples.length/samplerate},!1),audio.play(),setTimeout(function(){done({samplerate:samplerate,buffer:buffer,duration:duration})},1e3)},!1),audio.addEventListener("ended",function(){self._.isLoaded=!0,self._.plotFlush=!0,self.emit("loadeddata")},!1),audio.addEventListener("error",function(){self.emit("error")},!1),audio.load()}:void 0}(),wav_decoder=function(data,done){if(82!==data[0]||73!==data[1]||70!==data[2]||70!==data[3])return done(!1);var l1=data[4]+(data[5]<<8)+(data[6]<<16)+(data[7]<<24);if(l1+8!==data.length)return done(!1);if(87!==data[8]||65!==data[9]||86!==data[10]||69!==data[11])return done(!1);if(102!==data[12]||109!==data[13]||116!==data[14]||32!==data[15])return done(!1);var channels=data[22]+(data[23]<<8),samplerate=data[24]+(data[25]<<8)+(data[26]<<16)+(data[27]<<24),bitSize=data[34]+(data[35]<<8);
if(100!==data[36]||97!==data[37]||116!==data[38]||97!==data[39])return done(!1);var l2=data[40]+(data[41]<<8)+(data[42]<<16)+(data[43]<<24),duration=(l2/channels>>1)/samplerate;if(l2>data.length-44)return done(!1);var buffer=new Float32Array(0|duration*samplerate);done({samplerate:samplerate,buffer:buffer,duration:duration}),8===bitSize?data=new Int8Array(data.buffer,44):16===bitSize?data=new Int16Array(data.buffer,44):32===bitSize?data=new Int32Array(data.buffer,44):24===bitSize&&(data=_24bit_to_32bit(new Uint8Array(data.buffer,44))),2===channels&&(data=deinterleave(data));for(var k=1/((1<<bitSize-1)-1),i=buffer.length;i--;)buffer[i]=data[i]*k;this._.isLoaded=!0,this._.plotFlush=!0,this.emit("loadeddata")};timbre.fn.register("audio",AudioFile)}(timbre),function(timbre){"use strict";function FFTListener(_args){timbre.ListenerObject.call(this,_args),this._.status=0,this._.samples=0,this._.samplesIncr=0,this._.writeIndex=0,this._.plotFlush=!0,this._.plotRange=[0,.5],this._.plotBarStyle=!0,this.once("init",oninit),timbre.fn.fixAR(this)}function FFT(n){n="number"==typeof n?n:512,n=1<<Math.ceil(Math.log(n)*Math.LOG2E),this.length=n,this.buffer=new Float32Array(n),this.real=new Float32Array(n),this.imag=new Float32Array(n),this._real=new Float32Array(n),this._imag=new Float32Array(n),this.spectrum=new Float32Array(n>>1);var params=FFTParams.get(n);this._bitrev=params.bitrev,this._sintable=params.sintable,this._costable=params.costable}timbre.fn.extend(FFTListener,timbre.ListenerObject);var oninit=function(){var _=this._;_.fft||(this.size=512),_.interval||(this.interval=500)},$=FFTListener.prototype;Object.defineProperties($,{size:{set:function(value){var _=this._;if(!_.fft&&"number"==typeof value){var n=256>value?256:value>2048?2048:value;_.fft=new FFT(n),_.buffer=new Float32Array(_.fft.length),_.reservedwindow&&(_.fft.setWindow(_.reservedwindow),_.reservedwindow=null),_.reservedinterval&&(this.interval=_.reservedinterval,_.reservedinterval=null)}},get:function(){return this._.buffer.length}},window:{set:function(value){this._.fft?this._.fft.setWindow(value):this._.reservedwindow=value},get:function(){return this._.fft.windowName}},interval:{set:function(value){var _=this._;"number"==typeof value&&value>0&&(_.buffer?(_.interval=value,_.samplesIncr=.001*value*timbre.samplerate,_.samplesIncr<_.buffer.length&&(_.samplesIncr=_.buffer.length,_.interval=1e3*_.samplesIncr/timbre.samplerate)):_.reservedinterval=value)},get:function(){return this._.interval}},spectrum:{get:function(){return this._.fft.spectrum}},real:{get:function(){return this._.fft.real}},imag:{get:function(){return this._.fft.imag}}}),$.createInnerInstance=function(n){return new FFT(n)},$.bang=function(){return this._.samples=0,this._.writeIndex=0,this.emit("bang"),this},$.seq=function(seq_id){var _=this._,cell=this.cell;if(this.seq_id!==seq_id){this.seq_id=seq_id;var i,j,tmp,inputs=this.inputs,imax=inputs.length,jmax=cell.length;for(j=jmax;j--;)cell[j]=0;for(i=0;imax>i;++i)for(tmp=inputs[i].seq(seq_id),j=jmax;j--;)cell[j]+=tmp[j];var emit,status=_.status,samples=_.samples,samplesIncr=_.samplesIncr,writeIndex=_.writeIndex,buffer=_.buffer,bufferLength=buffer.length,mul=_.mul,add=_.add;for(j=0;jmax>j;++j)0>=samples&&0===status&&(status=1,writeIndex=0,samples+=samplesIncr),1===status&&(buffer[writeIndex++]=cell[j],writeIndex>=bufferLength&&(_.fft.forward(buffer),emit=_.plotFlush=!0,status=0)),cell[j]=cell[j]*mul+add,--samples;_.samples=samples,_.status=status,_.writeIndex=writeIndex,emit&&this.emit("fft")}return cell},$.plot=function(opts){if(this._.plotFlush){var i,j,v,fft=this._.fft,spectrum=fft.spectrum,step=fft.length>>6,istep=1/step,data=new Float32Array(spectrum.length*istep),imax=spectrum.length,jmax=step,k=0;for(i=0;imax>i;i+=step){for(v=0,j=0;jmax>j;++j)v+=spectrum[i+j];data[k++]=v*istep}this._.plotData=data,this._.plotFlush=null}return FFTListener.__super__.plot.call(this,opts)},FFT.prototype.setWindow=function(key){if("string"==typeof key){var m=/([A-Za-z]+)(?:\(([01]\.?\d*)\))?/.exec(key);if(null!==m){var name=m[1].toLowerCase(),a=void 0!==m[2]?+m[2]:.25,f=WindowFunctions[name];if(f){this._window||(this._window=new Float32Array(this.length));var w=this._window,n=0,N=this.length;for(a=0>a?0:a>1?1:a;N>n;++n)w[n]=f(n,N,a);this.windowName=key}}}},FFT.prototype.forward=function(_buffer){var i,j,k,k2,h,d,c,s,ik,dx,dy,buffer=this.buffer,real=this.real,imag=this.imag,window=this._window,bitrev=this._bitrev,sintable=this._sintable,costable=this._costable,n=buffer.length;if(window)for(i=n;i--;)buffer[i]=_buffer[i]*window[i];else for(i=n;i--;)buffer[i]=_buffer[i];for(i=n;i--;)real[i]=buffer[bitrev[i]],imag[i]=0;for(k=1;n>k;k=k2)for(h=0,k2=k+k,d=n/k2,j=0;k>j;j++){for(c=costable[h],s=sintable[h],i=j;n>i;i+=k2)ik=i+k,dx=s*imag[ik]+c*real[ik],dy=c*imag[ik]-s*real[ik],real[ik]=real[i]-dx,real[i]+=dx,imag[ik]=imag[i]-dy,imag[i]+=dy;h+=d}if(!this.noSpectrum){var rval,ival,mag,spectrum=this.spectrum,max=0;for(i=n;i--;)rval=real[i],ival=imag[i],mag=n*Math.sqrt(rval*rval+ival*ival),spectrum[i]=mag,mag>max&&(max=mag);if(max>0)for(max=1/max,i=n;i--;)spectrum[i]*=max}return{real:real,imag:imag}},FFT.prototype.inverse=function(_real,_imag){var i,j,k,k2,h,d,c,s,ik,dx,dy,buffer=this.buffer,real=this._real,imag=this._imag,bitrev=this._bitrev,sintable=this._sintable,costable=this._costable,n=buffer.length;for(i=n;i--;)j=bitrev[i],real[i]=+_real[j],imag[i]=-_imag[j];for(k=1;n>k;k=k2)for(h=0,k2=k+k,d=n/k2,j=0;k>j;j++){for(c=costable[h],s=sintable[h],i=j;n>i;i+=k2)ik=i+k,dx=s*imag[ik]+c*real[ik],dy=c*imag[ik]-s*real[ik],real[ik]=real[i]-dx,real[i]+=dx,imag[ik]=imag[i]-dy,imag[i]+=dy;h+=d}for(i=n;i--;)buffer[i]=real[i]/n;return buffer};var FFTParams={get:function(n){return FFTParams[n]||function(){var i,bitrev=function(){var x,i,j,k,n2;for(x=new Int16Array(n),n2=n>>1,i=j=0;x[i]=j,!(++i>=n);){for(k=n2;j>=k;)j-=k,k>>=1;j+=k}return x}(),k=Math.floor(Math.log(n)/Math.LN2),sintable=new Float32Array((1<<k)-1),costable=new Float32Array((1<<k)-1),PI2=2*Math.PI;for(i=sintable.length;i--;)sintable[i]=Math.sin(PI2*(i/n)),costable[i]=Math.cos(PI2*(i/n));return FFTParams[n]={bitrev:bitrev,sintable:sintable,costable:costable}}()}},WindowFunctions=function(){var PI=Math.PI,PI2=2*Math.PI,abs=Math.abs,pow=Math.pow,cos=Math.cos,sin=Math.sin,sinc=function(x){return sin(PI*x)/(PI*x)},E=Math.E;return{rectangular:function(){return 1},hann:function(n,N){return.5*(1-cos(PI2*n/(N-1)))},hamming:function(n,N){return.54-.46*cos(PI2*n/(N-1))},tukery:function(n,N,a){return a*(N-1)/2>n?.5*(1+cos(PI*(2*n/(a*(N-1))-1))):n>(N-1)*(1-a/2)?.5*(1+cos(PI*(2*n/(a*(N-1))-2/a+1))):1},cosine:function(n,N){return sin(PI*n/(N-1))},lanczos:function(n,N){return sinc(2*n/(N-1)-1)},triangular:function(n,N){return 2/(N+1)*((N+1)/2-abs(n-(N-1)/2))},bartlett:function(n,N){return 2/(N-1)*((N-1)/2-abs(n-(N-1)/2))},gaussian:function(n,N,a){return pow(E,-.5*pow((n-(N-1)/2)/(a*(N-1)/2),2))},bartlettHann:function(n,N){return.62-.48*abs(n/(N-1)-.5)-.38*cos(PI2*n/(N-1))},blackman:function(n,N,a){var a0=(1-a)/2,a1=.5,a2=a/2;return a0-a1*cos(PI2*n/(N-1))+a2*cos(4*PI*n/(N-1))}}}();timbre.fn.register("fft",FFTListener)}(timbre),function(timbre){"use strict";function Biquad(_args){timbre.Object.call(this,_args),this._.biquad=new BiquadFilter({samplerate:timbre.samplerate}),this._.plotRange=[0,1.2],this._.plotFlush=!0,this.once("init",oninit),timbre.fn.fixAR(this)}function BiquadFilter(opts){opts=opts||{},this.samplerate=opts.samplerate||44100,this.frequency=340,this.Q=1,this.gain=0,this.x1=this.x2=this.y1=this.y2=0,this.b0=this.b1=this.b2=this.a1=this.a2=0,this.setType(setParams[opts.type]?opts.type:"LPF")}timbre.fn.extend(Biquad,timbre.Object);var oninit=function(){this._.freq||(this.freq=340),this._.Q||(this.Q=1),this._.gain||(this.gain=0)},$=Biquad.prototype;Object.defineProperties($,{type:{set:function(value){var _=this._;value!==_.biquad.type&&(_.biquad.setType(value),_.plotFlush=!0)},get:function(){return this._.biquad.type}},freq:{set:function(value){this._.freq=timbre(value)},get:function(){return this._.freq}},Q:{set:function(value){this._.Q=timbre(value)},get:function(){return this._.Q}},gain:{set:function(value){this._.gain=timbre(value)},get:function(){return this._.gain}}}),$.createInnerInstance=function(type){return new BiquadFilter(type)},$.seq=function(seq_id){var _=this._,cell=this.cell;if(this.seq_id!==seq_id){this.seq_id=seq_id;var changed=!1,freq=_.freq.seq(seq_id)[0];_.prevFreq!==freq&&(_.prevFreq=freq,changed=!0);var Q=_.Q.seq(seq_id)[0];_.prevQ!==Q&&(_.prevQ=Q,changed=!0);var gain=_.gain.seq(seq_id)[0];_.prevGain!==gain&&(_.prevGain=gain,changed=!0),changed&&(_.biquad.setParams(freq,Q,gain),_.plotFlush=!0);var tmp,i,imax,j,inputs=this.inputs,mul=_.mul,add=_.add;for(j=cell.length;j--;)cell[j]=0;for(i=0,imax=inputs.length;imax>i;++i)for(tmp=inputs[i].seq(seq_id),j=cell.length;j--;)cell[j]+=tmp[j];for(_.biquad.process(cell),j=cell.length;j--;)cell[j]=cell[j]*mul+add}return cell},$.plot=function(){var fft=timbre("fft").createInnerInstance(256);return function(opts){if(this._.plotFlush){var biquad=new BiquadFilter({type:this.type,samplerate:timbre.samplerate});biquad.setParams(this.freq.valueOf(),this.Q.valueOf(),this.gain.valueOf());var impluse=new Float32Array(256);impluse[0]=1,biquad.process(impluse),fft.forward(impluse),this._.plotData=fft.spectrum,this._.plotFlush=null}return Biquad.__super__.plot.call(this,opts)}}(),BiquadFilter.prototype.process=function(cell){for(var x0,y0,x1=this.x1,x2=this.x2,y1=this.y1,y2=this.y2,b0=this.b0,b1=this.b1,b2=this.b2,a1=this.a1,a2=this.a2,i=0,imax=cell.length;imax>i;++i)x0=cell[i],y0=b0*x0+b1*x1+b2*x2-a1*y1-a2*y2,cell[i]=-1>y0?-1:y0>1?1:y0,x2=x1,x1=x0,y2=y1,y1=y0;(x1>0&&152587890625e-16>x1||0>x1&&x1>-152587890625e-16)&&(x1=0),(y1>0&&152587890625e-16>y1||0>y1&&y1>-152587890625e-16)&&(y1=0),this.x1=x1,this.x2=x2,this.y1=y1,this.y2=y2},BiquadFilter.prototype.setType=function(type){var f;(f=setParams[type])&&(this.type=type,f.call(this,this.frequency,this.Q,this.gain))},BiquadFilter.prototype.setParams=function(frequency,Q,dbGain){this.frequency=frequency,this.Q=Q,this.gain=dbGain;var f=setParams[this.type];return f&&f.call(this,frequency,Q,dbGain),this};var setParams={lowpass:function(cutoff,resonance){if(cutoff/=.5*this.samplerate,cutoff>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=cutoff)this.b0=this.b1=this.b2=this.a1=this.a2=0;else{resonance=0>resonance?0:resonance;var g=Math.pow(10,.05*resonance),d=Math.sqrt(.5*(4-Math.sqrt(16-16/(g*g)))),theta=Math.PI*cutoff,sn=.5*d*Math.sin(theta),beta=.5*(1-sn)/(1+sn),gamma=(.5+beta)*Math.cos(theta),alpha=.25*(.5+beta-gamma);this.b0=2*alpha,this.b1=4*alpha,this.b2=this.b0,this.a1=2*-gamma,this.a2=2*beta}},highpass:function(cutoff,resonance){if(cutoff/=.5*this.samplerate,cutoff>=1)this.b0=this.b1=this.b2=this.a1=this.a2=0;else if(0>=cutoff)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{resonance=0>resonance?0:resonance;var g=Math.pow(10,.05*resonance),d=Math.sqrt((4-Math.sqrt(16-16/(g*g)))/2),theta=Math.PI*cutoff,sn=.5*d*Math.sin(theta),beta=.5*(1-sn)/(1+sn),gamma=(.5+beta)*Math.cos(theta),alpha=.25*(.5+beta+gamma);this.b0=2*alpha,this.b1=-4*alpha,this.b2=this.b0,this.a1=2*-gamma,this.a2=2*beta}},bandpass:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=alpha*ia0,this.b1=0,this.b2=-alpha*ia0,this.a1=-2*k*ia0,this.a2=(1-alpha)*ia0}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=this.b1=this.b2=this.a1=this.a2=0},lowshelf:function(frequency,_dummy_,dbGain){frequency/=.5*this.samplerate;var A=Math.pow(10,dbGain/40);if(frequency>=1)this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0;else if(0>=frequency)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{var w0=Math.PI*frequency,S=1,alpha=.5*Math.sin(w0)*Math.sqrt((A+1/A)*(1/S-1)+2),k=Math.cos(w0),k2=2*Math.sqrt(A)*alpha,aPlusOne=A+1,aMinusOne=A-1,ia0=1/(aPlusOne+aMinusOne*k+k2);this.b0=A*(aPlusOne-aMinusOne*k+k2)*ia0,this.b1=2*A*(aMinusOne-aPlusOne*k)*ia0,this.b2=A*(aPlusOne-aMinusOne*k-k2)*ia0,this.a1=-2*(aMinusOne+aPlusOne*k)*ia0,this.a2=(aPlusOne+aMinusOne*k-k2)*ia0}},highshelf:function(frequency,_dummy_,dbGain){frequency/=.5*this.samplerate;var A=Math.pow(10,dbGain/40);if(frequency>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=frequency)this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0;else{var w0=Math.PI*frequency,S=1,alpha=.5*Math.sin(w0)*Math.sqrt((A+1/A)*(1/S-1)+2),k=Math.cos(w0),k2=2*Math.sqrt(A)*alpha,aPlusOne=A+1,aMinusOne=A-1,ia0=1/(aPlusOne-aMinusOne*k+k2);this.b0=A*(aPlusOne+aMinusOne*k+k2)*ia0,this.b1=-2*A*(aMinusOne+aPlusOne*k)*ia0,this.b2=A*(aPlusOne+aMinusOne*k-k2)*ia0,this.a1=2*(aMinusOne-aPlusOne*k)*ia0,this.a2=(aPlusOne-aMinusOne*k-k2)*ia0}},peaking:function(frequency,Q,dbGain){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency){var A=Math.pow(10,dbGain/40);if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha/A);this.b0=(1+alpha*A)*ia0,this.b1=-2*k*ia0,this.b2=(1-alpha*A)*ia0,this.a1=this.b1,this.a2=(1-alpha/A)*ia0}else this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0}else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},notch:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=ia0,this.b1=-2*k*ia0,this.b2=ia0,this.a1=this.b1,this.a2=(1-alpha)*ia0}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},allpass:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=(1-alpha)*ia0,this.b1=-2*k*ia0,this.b2=(1+alpha)*ia0,this.a1=this.b1,this.a2=this.b0}else this.b0=-1,this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0}};setParams.LPF=setParams.lowpass,setParams.HPF=setParams.highpass,setParams.BPF=setParams.bandpass,setParams.BEF=setParams.notch,setParams.BRF=setParams.notch,setParams.APF=setParams.allpass,timbre.fn.register("biquad",Biquad),timbre.fn.register("lowpass",function(_args){return new Biquad(_args).set("type","lowpass")}),timbre.fn.register("highpass",function(_args){return new Biquad(_args).set("type","highpass")}),timbre.fn.register("bandpass",function(_args){return new Biquad(_args).set("type","bandpass")}),timbre.fn.register("lowshelf",function(_args){return new Biquad(_args).set("type","lowshelf")}),timbre.fn.register("highshelf",function(_args){return new Biquad(_args).set("type","highshelf")}),timbre.fn.register("peaking",function(_args){return new Biquad(_args).set("type","peaking")}),timbre.fn.register("notch",function(_args){return new Biquad(_args).set("type","notch")}),timbre.fn.register("allpass",function(_args){return new Biquad(_args).set("type","allpass")}),timbre.fn.alias("LPF","lowpass"),timbre.fn.alias("HPF","highpass"),timbre.fn.alias("BPF","bandpass"),timbre.fn.alias("BEF","notch"),timbre.fn.alias("BRF","notch"),timbre.fn.alias("APF","allpass")}(timbre),function(){"use strict";function EfxDelayNode(_args){timbre.Object.call(this,_args),this._.delay=new EfxDelay,this.once("init",oninit),timbre.fn.fixAR(this)}function EfxDelay(opts){var bits=Math.ceil(Math.log(1.5*timbre.samplerate)*Math.LOG2E);this.cell=new Float32Array(timbre.cellsize),this.time=125,this.feedback=.25,this.buffer=new Float32Array(1<<bits),this.mask=(1<<bits)-1,this.wet=.45,this.readIndex=0,this.writeIndex=0|this.time/1e3*timbre.samplerate,opts&&this.setParams(opts)}timbre.fn.extend(EfxDelayNode,timbre.Object);var oninit=function(){this._.time||(this.time=100),this._.feedback||(this.feedback=.25),this._.wet||(this.wet=.2)},$=EfxDelayNode.prototype;Object.defineProperties($,{time:{set:function(value){"number"==typeof value&&value>0&&1500>value&&(this._.time=value,this._.delay.setParams({time:value}))},get:function(){return this._.time}},feedback:{set:function(value){this._.feedback=timbre(value)},get:function(){return this._.feedback}},wet:{set:function(value){this._.wet=timbre(value)},get:function(){return this._.wet}}}),$.createInnerInstance=function(opts){return new EfxDelay(opts)},$.seq=function(seq_id){var _=this._,cell=this.cell;if(this.seq_id!==seq_id){var changed=!1,feedback=_.feedback.seq(seq_id)[0];_.prevFeedback!==feedback&&(_.prevFeedback=feedback,changed=!0);var wet=_.wet.seq(seq_id)[0];_.prevWet!==wet&&(_.prevWet=wet,changed=!0),changed&&_.delay.setParams({feedback:feedback,wet:wet});var tmp,i,imax,j,inputs=this.inputs,mul=_.mul,add=_.add;for(j=cell.length;j--;)cell[j]=0;for(i=0,imax=inputs.length;imax>i;++i)for(tmp=inputs[i].seq(seq_id),j=cell.length;j--;)cell[j]+=tmp[j];for(_.delay.process(cell,!0),j=cell.length;j--;)cell[j]=cell[j]*mul+add}return cell},EfxDelay.prototype.setParams=function(opts){return opts.time&&(this.time=opts.time,this.writeIndex=this.readIndex+(0|.001*this.time*timbre.samplerate)),opts.feedback&&(this.feedback=opts.feedback),opts.wet&&(this.wet=opts.wet),this},EfxDelay.prototype.process=function(_cell,overwrite){var cell,buffer,writeIndex,readIndex,feedback,value,wet,dry,i,imax;for(cell=this.cell,buffer=this.buffer,writeIndex=this.writeIndex,readIndex=this.readIndex,feedback=this.feedback,wet=this.wet,dry=1-this.wet,i=0,imax=cell.length;imax>i;++i)value=buffer[readIndex],buffer[writeIndex]=_cell[i]-value*feedback,cell[i]=_cell[i]*dry+value*wet,writeIndex+=1,readIndex+=1;if(overwrite)for(;i--;)_cell[i]=cell[i];return this.writeIndex=writeIndex&this.mask,this.readIndex=readIndex&this.mask,cell},timbre.fn.register("efx.delay",EfxDelayNode)}(),function(timbre){"use strict";function Interval(_args){timbre.TimerObject.call(this,_args),this._.interval=1e3,this._.count=0,this._.limit=1/0,this._.currentTime=0,this._.currentTimeIncr=1e3*timbre.cellsize/timbre.samplerate,this._.delaySamples=0,this._.countSamples=0,this.once("init",oninit),this.on("start",onstart),timbre.fn.fixKR(this)}timbre.fn.extend(Interval,timbre.TimerObject);var oninit=function(){void 0===this._.delay&&(this.delay=this.interval)},onstart=function(){this._.currentTime=timbre.currentTime};Object.defineProperty(onstart,"unremovable",{value:!0,configurable:!1});var $=Interval.prototype;Object.defineProperties($,{interval:{set:function(value){"number"==typeof value&&value>=0&&(this._.interval=value)},get:function(){return this._.interval}},delay:{set:function(value){"number"==typeof value&&value>=0&&(this._.delay=value,this._.delaySamples=0|timbre.samplerate*.001*value)},get:function(){return this._.delay}},count:{set:function(value){"number"==typeof value&&(this._.count=value)},get:function(){return this._.count}},limit:{set:function(value){"number"==typeof value&&value>=0&&(this._.limit=value)},get:function(){return this._.limit}},currentTime:{get:function(){return this._.currentTime}}}),$.bang=function(){var _=this._;return _.delaySamples=0|timbre.samplerate*.001*_.delay,_.countSamples=_.count=0,_.currentTime=timbre.currentTime,this.emit("bang"),this},$.seq=function(seq_id){var cell=this.cell,_=this._;if(this.seq_id!==seq_id){if(this.seq_id=seq_id,_.delaySamples>0&&(_.delaySamples-=cell.length),0>=_.delaySamples&&(_.countSamples-=cell.length,0>=_.countSamples)){_.countSamples+=0|.001*timbre.samplerate*_.interval;for(var inputs=this.inputs,i=0,imax=inputs.length;imax>i;++i)inputs[i].bang();if(++_.count,_.count>=_.limit){var self=this;timbre.nextTick(function(){self.emit("limit"),self.pause()})}}_.currentTime+=_.currentTimeIncr}return cell},timbre.fn.register("interval",Interval),timbre.fn.register("timeout",function(_args){return new Interval(_args).once("init",function(){0===this.delay&&(this.delay=this.interval),this.limit=1})})}(timbre),function(){"use strict";function Map(_args){timbre.Object.call(this,_args),this._.inMin=0,this._.inMax=1,this._.outMin=0,this._.outMax=1,this.once("init",oninit),timbre.fn.fixKR(this)}timbre.fn.extend(Map,timbre.Object);var oninit=function(){this._.warp||(this.warp="linlin")},$=Map.prototype;Object.defineProperties($,{inMin:{set:function(value){"number"==typeof value&&(this._.inMin=value)},get:function(){return this._.inMin}},inMax:{set:function(value){"number"==typeof value&&(this._.inMax=value)},get:function(){return this._.inMax}},outMin:{set:function(value){"number"==typeof value&&(this._.outMin=value)},get:function(){return this._.outMin}},outMax:{set:function(value){"number"==typeof value&&(this._.outMax=value)},get:function(){return this._.outMax}},warp:{set:function(value){if("string"==typeof value){var f=WarpFunctions[value];f&&(this._.warp=f,this._.warpName=value)}},get:function(){return this._.warpName}}}),$.seq=function(seq_id){var _=this._,cell=this.cell;if(this.seq_id!==seq_id){this.seq_id=seq_id;var i,j,x,inputs=this.inputs,imax=inputs.length,jmax=cell.length;for(x=0,i=0;imax>i;++i)x+=inputs[i].seq(seq_id)[0];var inMin=_.inMin,inMax=_.inMax,outMin=_.outMin,outMax=_.outMax,warp=_.warp;for(x=warp(x,inMin,inMax,outMin,outMax)*_.mul+_.add,j=jmax;j--;)cell[j]=x}return cell};var WarpFunctions={linlin:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:inMax===inMin?outMin:(x-inMin)/(inMax-inMin)*(outMax-outMin)+outMin},linexp:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===outMin?0:inMax===inMin?outMax:Math.pow(outMax/outMin,(x-inMin)/(inMax-inMin))*outMin},explin:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===inMin?outMax:Math.log(x/inMin)/Math.log(inMax/inMin)*(outMax-outMin)+outMin},expexp:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===inMin||0===outMin?0:Math.pow(outMax/outMin,Math.log(x/inMin)/Math.log(inMax/inMin))*outMin}};timbre.fn.register("map",Map)}(),function(timbre){"use strict";function Mul(_args){timbre.Object.call(this,_args)}timbre.fn.extend(Mul,timbre.Object);var $=Mul.prototype;$.seq=function(seq_id){var cell=this.cell,_=this._;if(this.seq_id!==seq_id){this.seq_id=seq_id;var i,j,tmp,inputs=this.inputs,mul=_.mul,add=_.add,imax=inputs.length,jmax=cell.length;for(j=jmax;j--;)cell[j]=1;if(_.ar){for(i=0;imax>i;++i)for(tmp=inputs[i].seq(seq_id),j=jmax;j--;)cell[j]*=tmp[j];if(1!==mul||0!==add)for(j=jmax;j--;)cell[j]=cell[j]*mul+add}else{for(tmp=1,i=0;imax>i;++i)tmp*=inputs[i].seq(seq_id)[0];for(tmp=tmp*mul+add,j=jmax;j--;)cell[j]=tmp}}return cell},timbre.fn.register("*",Mul)}(timbre),function(timbre){"use strict";function Noise(_args){timbre.Object.call(this,_args)}timbre.fn.extend(Noise,timbre.Object);var $=Noise.prototype;$.seq=function(seq_id){var cell=this.cell,_=this._;if(this.seq_id!==seq_id){this.seq_id=seq_id;var i,x,mul=_.mul,add=_.add,r=Math.random;if(_.ar)for(i=cell.length;i--;)cell[i]=(2*r()-1)*mul+add;else for(x=(2*r()+1)*mul+add,i=cell.length;i--;)cell[i]=x}return cell},timbre.fn.register("noise",Noise)}(timbre),function(timbre){"use strict";function Oscillator(_args){timbre.Object.call(this,_args),this._.phase=0,this._.x=0,this._.coeff=1024/timbre.samplerate,this.once("init",oninit)}function waveshape(sign,name,shape,width){var _wave,i,imax,j,jmax,wave=Wavetables[name];if(void 0!==wave){switch("function"==typeof wave&&(wave=wave()),shape){case"@1":for(i=512;1024>i;++i)wave[i]=0;break;case"@2":for(i=512;1024>i;++i)wave[i]=Math.abs(wave[i]);break;case"@3":for(i=256;512>i;++i)wave[i]=0;for(i=512;768>i;++i)wave[i]=Math.abs(wave[i]);for(i=768;1024>i;++i)wave[i]=0;break;case"@4":for(_wave=new Float32Array(1024),i=0;512>i;++i)_wave[i]=wave[i<<1];wave=_wave;break;case"@5":for(_wave=new Float32Array(1024),i=0;512>i;++i)_wave[i]=Math.abs(wave[i<<1]);wave=_wave}if(void 0!==width){for(width*=.01,width=0>width?0:width>1?1:width,_wave=new Float32Array(1024),imax=0|1024*width,i=0;imax>i;++i)_wave[i]=wave[0|512*(i/imax)];for(jmax=1024-imax,j=0;1024>i;++i,++j)_wave[i]=wave[0|512*(j/jmax)+512];wave=_wave}if("+"===sign)for(i=1024;i--;)wave[i]=.5*wave[i]+.5;else if("-"===sign)for(i=1024;i--;)wave[i]*=-1;return wave}}function wavb(src){var wave=new Float32Array(1024),n=src.length>>1;if(-1!==[2,4,8,16,32,64,128,256,512,1024].indexOf(n))for(var i=0,k=0;n>i;++i){var x=parseInt(src.substr(2*i,2),16);x=128&x?(x-256)/128:x/127;for(var j=1024/n;j--;)wave[k++]=x}return wave}function wavc(src){var wave=new Float32Array(1024);if(8===src.length){var i,j,color=parseInt(src,16),bar=new Float32Array(8);for(bar[0]=1,i=0;7>i;++i)bar[i+1]=.0625*(15&color),color>>=4;for(i=0;8>i;++i){var x=0,dx=(i+1)/1024;for(j=0;1024>j;++j)wave[j]+=Math.sin(2*Math.PI*x)*bar[i],x+=dx}var absx,maxx=0;for(i=1024;i--;)(absx=Math.abs(wave[i]))>maxx&&(maxx=absx);if(maxx>0)for(i=1024;i--;)wave[i]/=maxx}return wave}timbre.fn.extend(Oscillator,timbre.Object);var oninit=function(){var _=this._;_.wave||(this.wave="sin"),_.freq||(this.freq=440),this._.plotData=this._.wave,this._.plotLineWidth=2,this._.plotCyclic=!0,this._.plotBefore=plotBefore},$=Oscillator.prototype;Object.defineProperties($,{wave:{set:function(value){this._.wave||(this._.wave=new Float32Array(1024));var dx,i,wave=this._.wave;if("function"==typeof value)for(i=0;1024>i;++i)wave[i]=value(i/1024);else if(value instanceof Float32Array)if(value.length===wave.length)wave.set(value);else for(dx=value.length/1024,i=0;1024>i;++i)wave[i]=value[0|i*dx];else"string"==typeof value&&void 0!==(dx=this.getWavetable(value))&&(this._.wave=dx)},get:function(){return this._.wave}},freq:{set:function(value){this._.freq=timbre(value)},get:function(){return this._.freq}},phase:{set:function(value){if("number"==typeof value){for(;value>=1;)value-=1;for(;0>value;)value+=1;this._.phase=value,this._.x=1024*this._.phase}},get:function(){return this._.phase}}}),$.bang=function(){return this._.x=1024*this._.phase,this.emit("bang"),this},$.seq=function(seq_id){var _=this._,cell=this.cell;if(this.seq_id!==seq_id){this.seq_id=seq_id;var i,j,tmp,inputs=this.inputs,imax=inputs.length,jmax=cell.length,mul=_.mul,add=_.add;if(inputs.length){for(j=jmax;j--;)cell[j]=0;for(i=0;imax>i;++i)for(tmp=inputs[i].seq(seq_id),j=jmax;j--;)cell[j]+=tmp[j]}else for(j=jmax;j--;)cell[j]=1;var index,delta,x0,x1,xx,dx,freq=_.freq.seq(seq_id),wave=_.wave,x=_.x,coeff=_.coeff;if(_.ar)if(_.freq.isAr)for(j=0;jmax>j;++j)index=0|x,delta=x-index,x0=wave[1023&index],x1=wave[1023&index+1],cell[j]*=(1-delta)*x0+delta*x1,x+=freq[j]*coeff;else for(dx=freq[0]*coeff,j=0;jmax>j;++j)index=0|x,delta=x-index,x0=wave[1023&index],x1=wave[1023&index+1],cell[j]*=(1-delta)*x0+delta*x1,x+=dx;else{for(index=0|x,delta=x-index,x0=wave[1023&index],x1=wave[1023&index+1],xx=(1-delta)*x0+delta*x1,j=jmax;j--;)cell[j]*=xx;x+=freq[0]*coeff*jmax}for(;x>1024;)x-=1024;for(_.x=x,j=jmax;j--;)cell[j]=cell[j]*mul+add}return cell};var plotBefore;"browser"===timbre.envtype&&(plotBefore=function(context,offset_x,offset_y,width,height){var y=(height>>1)+.5;context.strokeStyle="#ccc",context.lineWidth=1,context.beginPath(),context.moveTo(offset_x,y+offset_y),context.lineTo(offset_x+width,y+offset_y),context.stroke()}),Oscillator.getWavetable=$.getWavetable=function(key){var wave=Wavetables[key];if(void 0!==wave)return"function"==typeof wave&&(wave=wave()),wave;var m;if(m=/^([\-+]?)(\w+)(?:\((@[0-7])?:?(\d+)?\))?$/.exec(key),null!==m){var sign=m[1],name=m[2],shape=m[3],width=m[4];if(wave=waveshape(sign,name,shape,width),void 0!==wave)return Wavetables[key]=wave}return m=/^wavb\(((?:[0-9a-fA-F][0-9a-fA-F])+)\)$/.exec(key),null!==m?wavb(m[1]):(m=/^wavc\(([0-9a-fA-F]{8})\)$/.exec(key),null!==m?wavc(m[1]):void 0)},Oscillator.setWavetable=$.setWavetable=function(name,value){var dx,i,wave=new Float32Array(1024);if("function"==typeof value)for(i=0;1024>i;++i)wave[i]=value(i/1024);else if(value instanceof Float32Array)if(value.length===wave.length)wave.set(value);else for(dx=value.length/1024,i=0;1024>i;++i)wave[i]=value[0|i*dx];Wavetables[name]=wave};var Wavetables=Oscillator.Wavetables={sin:function(){for(var wave=new Float32Array(1024),i=1024;i--;)wave[i]=Math.sin(2*Math.PI*(i/1024));return wave},cos:function(){for(var wave=new Float32Array(1024),i=1024;i--;)wave[i]=Math.cos(2*Math.PI*(i/1024));return wave},pulse:function(){for(var wave=new Float32Array(1024),i=1024;i--;)wave[i]=512>i?1:-1;return wave},tri:function(){for(var x,wave=new Float32Array(1024),i=1024;i--;)x=i/1024-.25,wave[i]=1-4*Math.abs(Math.round(x)-x);return wave},saw:function(){for(var x,wave=new Float32Array(1024),i=1024;i--;)x=i/1024,wave[i]=2*(x-Math.round(x));return wave},fami:function(){for(var d=[0,.125,.25,.375,.5,.625,.75,.875,.875,.75,.625,.5,.375,.25,.125,0,-.125,-.25,-.375,-.5,-.625,-.75,-.875,-1,-1,-.875,-.75,-.625,-.5,-.375,-.25,-.125],wave=new Float32Array(1024),i=1024;i--;)wave[i]=d[0|i/1024*d.length];return wave},konami:function(){for(var d=[-.625,-.875,-.125,.75,.5,.125,.5,.75,.25,-.125,.5,.875,.625,0,.25,.375,-.125,-.75,0,.625,.125,-.5,-.375,-.125,-.75,-1,-.625,0,-.375,-.875,-.625,-.25],wave=new Float32Array(1024),i=1024;i--;)wave[i]=d[0|i/1024*d.length];return wave}};timbre.fn.register("osc",Oscillator),timbre.fn.register("sin",function(_args){return new Oscillator(_args).set("wave","sin")}),timbre.fn.register("cos",function(_args){return new Oscillator(_args).set("wave","cos")}),timbre.fn.register("pulse",function(_args){return new Oscillator(_args).set("wave","pulse")}),timbre.fn.register("tri",function(_args){return new Oscillator(_args).set("wave","tri")}),timbre.fn.register("saw",function(_args){return new Oscillator(_args).set("wave","saw")}),timbre.fn.register("fami",function(_args){return new Oscillator(_args).set("wave","fami")}),timbre.fn.register("konami",function(_args){return new Oscillator(_args).set("wave","konami")}),timbre.fn.register("+sin",function(_args){return new Oscillator(_args).set("wave","+sin")}),timbre.fn.register("+pulse",function(_args){return new Oscillator(_args).set("wave","+pulse")}),timbre.fn.register("+tri",function(_args){return new Oscillator(_args).set("wave","+tri")}),timbre.fn.register("+saw",function(_args){return new Oscillator(_args).set("wave","+saw")}),timbre.fn.alias("square","pulse")}(timbre),function(){"use strict";function Panner(_args){timbre.StereoObject.call(this,_args),this._.panL=.5,this._.panR=.5,this.once("init",oninit),timbre.fn.fixAR(this)}timbre.fn.extend(Panner,timbre.StereoObject);var oninit=function(){this._.value||(this.value=0)},$=Panner.prototype;Object.defineProperties($,{value:{set:function(value){this._.value=timbre(value)},get:function(){return this._.value}}}),$.seq=function(seq_id){var _=this._,cell=this.cell;if(this.seq_id!==seq_id){this.seq_id=seq_id;var changed=!1,value=_.value.seq(seq_id)[0];_.prevValue!==value&&(_.prevValue=value,changed=!0),changed&&(_.panL=Math.cos(.5*Math.PI*(.5*value+.5)),_.panR=Math.sin(.5*Math.PI*(.5*value+.5)));var i,j,tmp,x,inputs=this.inputs,imax=inputs.length,jmax=cell.length,mul=_.mul,add=_.add,cellL=this.cellL,cellR=this.cellR;for(j=jmax;j--;)cellL[j]=cellR[j]=cell[j]=0;for(i=0;imax>i;++i)for(tmp=inputs[i].seq(seq_id),j=jmax;j--;)cellL[j]=cellR[j]=cell[j]+=tmp[j];var panL=_.panL,panR=_.panR;for(j=jmax;j--;)x=cellL[j]=cellL[j]*panL*mul+add,x+=cellR[j]=cellR[j]*panR*mul+add,cell[j]=.5*x}return cell},timbre.fn.register("pan",Panner)}(),function(timbre){"use strict";function ParamEvent(type,value,time){this.type=type,this.value=value,this.time=time}function Param(_args){timbre.Object.call(this,_args),this._.value=0,this._.minvalue=-1/0,this._.maxValue=+1/0,this._.eventtype=ParamEvent.None,this._.currentTimeIncr=1e3*this.cell.length/timbre.samplerate,this._.schedules=[],this.on("setAdd",changeTheValue),this.on("setMul",changeTheValue),timbre.fn.fixKR(this)}ParamEvent.None=0,ParamEvent.SetValue=1,ParamEvent.LinearRampToValue=2,ParamEvent.ExponentialRampToValue=3,ParamEvent.SetValueCurve=4,timbre.fn.extend(Param,timbre.Object);var changeTheValue=function(){for(var _=this._,x=_.value*_.mul+_.add,cell=this.cell,i=cell.length;i--;)cell[i]=x};Object.defineProperty(changeTheValue,"unremovable",{value:!0,configurable:!1});var $=Param.prototype;Object.defineProperties($,{value:{set:function(value){if("number"==typeof value){var _=this._;
value=_.minvalue>value?_.minvalue:value>_.maxValue?_.maxValue:value,_.value=isNaN(value)?0:value,_.eventtype=ParamEvent.None,changeTheValue.call(this)}},get:function(){return this._.value}},minValue:{set:function(value){"number"==typeof value&&(this._.minValue=value)},get:function(){return this._.minValue}},maxValue:{set:function(value){"number"==typeof value&&(this._.maxValue=value)},get:function(){return this._.maxValue}}});var insertEvent=function(object,type,value,time){var s=object._.schedules,e=new ParamEvent(type,value,time);s.push(e),s.sort(function(a,b){return a.time-b.time})};$.setValueAtTime=function(value,time){var _=this._;return"number"==typeof value&&"number"==typeof time&&(value=_.minvalue>value?_.minvalue:value>_.maxValue?_.maxValue:value,_.currentTime=timbre.currentTime,insertEvent(this,ParamEvent.SetValue,value,time)),this},$.linearRampToValueAtTime=function(value,time){var _=this._;return _.currentTime=timbre.currentTime,"number"==typeof value&&"number"==typeof time&&(value=_.minvalue>value?_.minvalue:value>_.maxValue?_.maxValue:value,insertEvent(this,ParamEvent.LinearRampToValue,value,time)),this},$.lin=$.linearRampToValueAtTime,$.exponentialRampToValueAtTime=function(value,time){var _=this._;return _.currentTime=timbre.currentTime,"number"==typeof value&&"number"==typeof time&&(value=_.minvalue>value?_.minvalue:value>_.maxValue?_.maxValue:value,insertEvent(this,ParamEvent.ExponentialRampToValue,value,time)),this},$.exp=$.exponentialRampToValueAtTime,$.cancelScheduledValues=function(time){if("number"==typeof time)for(var s=this._.schedules,i=0,imax=s.length;imax>i;++i)if(s[i].time>=time){s.splice(i),0===i&&(this._.eventtype=ParamEvent.None);break}return this},$.cancel=$.cancelScheduledValues,$.seq=function(seq_id){var _=this._,cell=this.cell;if(this.seq_id!==seq_id){this.seq_id=seq_id;for(var e,samples,schedules=_.schedules;_.eventtype===ParamEvent.None&&schedules.length>0&&_.currentTime<=schedules[0].time;)switch(e=schedules.shift(),e.type){case ParamEvent.SetValue:_.eventtype=ParamEvent.SetValue,_.goalValue=e.value,_.goalTime=e.time;break;case ParamEvent.LinearRampToValue:samples=.001*(e.time-_.currentTime)*timbre.samplerate,samples>0&&(_.eventtype=ParamEvent.LinearRampToValue,_.goalValue=e.value,_.goalTime=e.time,_.variation=(e.value-_.value)/(samples/cell.length));break;case ParamEvent.ExponentialRampToValue:samples=.001*(e.time-_.currentTime)*timbre.samplerate,0!==_.value&&samples>0&&(_.eventtype=ParamEvent.ExponentialRampToValue,_.goalValue=e.value,_.goalTime=e.time,_.variation=Math.pow(e.value/_.value,1/(samples/cell.length)))}var i,x,changed=!1,emit=!1;switch(_.eventtype){case ParamEvent.LinearRampToValue:_.currentTime<_.goalTime&&(_.value+=_.variation,changed=!0);break;case ParamEvent.ExponentialRampToValue:_.currentTime<_.goalTime&&(_.value*=_.variation,changed=!0)}if(_.currentTime+=_.currentTimeIncr,_.eventtype!==ParamEvent.None&&_.currentTime>=_.goalTime&&(_.value=_.goalValue,_.eventtype=ParamEvent.None,changed=emit=!0),changed){for(x=_.value*_.mul+_.add,i=cell.length;i--;)cell[i]=x;emit&&this.emit("done",_.value)}}return cell},timbre.fn.register("param",Param)}(timbre),function(timbre){"use strict";function WaveListener(_args){timbre.ListenerObject.call(this,_args),this._.samples=0,this._.writeIndex=0,this._.plotFlush=!0,this.once("init",oninit),timbre.fn.fixAR(this)}timbre.fn.extend(WaveListener,timbre.ListenerObject);var oninit=function(){this._.buffer||(this.size=1024),this._.interval||(this.interval=1e3)},$=WaveListener.prototype;Object.defineProperties($,{size:{set:function(value){var _=this._;if(!_.buffer&&"number"==typeof value){var n=64>value?64:value>2048?2048:value;_.buffer=new Float32Array(n),_.reservedinterval&&(this.interval=_.reservedinterval,_.reservedinterval=null)}},get:function(){return this._.buffer.length}},interval:{set:function(value){var _=this._;"number"==typeof value&&value>0&&(_.buffer?(_.interval=value,_.samplesIncr=.001*value*timbre.samplerate/_.buffer.length,1>_.samplesIncr&&(_.samplesIncr=1)):_.reservedinterval=value)},get:function(){return this._.interval}}}),$.bang=function(){for(var _=this._,buffer=_.buffer,i=buffer.length;i--;)buffer[i]=0;return _.samples=0,_.writeIndex=0,this.emit("bang"),this},$.seq=function(seq_id){var _=this._,cell=this.cell;if(this.seq_id!==seq_id){this.seq_id=seq_id;var i,j,tmp,inputs=this.inputs,imax=inputs.length,jmax=cell.length;for(j=jmax;j--;)cell[j]=0;for(i=0;imax>i;++i)for(tmp=inputs[i].seq(seq_id),j=jmax;j--;)cell[j]+=tmp[j];var samples=_.samples,samplesIncr=_.samplesIncr,buffer=_.buffer,writeIndex=_.writeIndex,emit=!1,mul=_.mul,add=_.add,mask=buffer.length-1;for(j=0;jmax>j;++j)0>=samples&&(buffer[writeIndex++]=cell[j],writeIndex&=mask,emit=_.plotFlush=!0,samples+=samplesIncr),cell[j]=cell[j]*mul+add,--samples;_.samples=samples,_.writeIndex=writeIndex,emit&&this.emit("wave")}return cell},$.plot=function(opts){var _=this._;if(_.plotFlush){for(var buffer=_.buffer,mask=buffer.length-1,data=new Float32Array(buffer.length),j=_.writeIndex,i=0,imax=buffer.length;imax>i;i++)data[i]=buffer[++j&mask];_.plotData=data,_.plotFlush=null}return WaveListener.__super__.plot.call(this,opts)},timbre.fn.register("wave",WaveListener)}(timbre);