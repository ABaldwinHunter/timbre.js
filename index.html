<html lang="en">
  <head>
    <title>T("timbre.js") - A JavaScript Library for Objective Sound Programming</title>
  </head>
  <body style="text-align:center">
    <h1 style="margin-top:50px;font-family:'Arial';text-shadow:0 2px 8px #999">
      T("timbre.js")
    </h1>
    <canvas id="viewer" style="margin:25px;width:480px;height:80px"></canvas>
    <div>
      <button onclick="timbre.amp = 1 - timbre.amp;">SOUND</button>
    </div>
    <div style="margin-top:25px">
      new version; now under development
    </div>
    <script src="./misc/requestAnimationFrame.js"></script>
    <script src="./timbre.dev.js"></script>
    <script src="./src/extras/mouse.js"></script>
    <script>
      var viewer = document.getElementById("viewer");
      viewer.width  = 480;
      viewer.height =  80;
      
      var mouse = T("mouse").on("click", function() {
          filter.type = (filter.type === "LPF") ? "HPF" : "LPF";
      }).start();
      var mouseX = T("mouse.x", {minval:80, maxval:12000});
      var mouseY = T("mouse.y", {minval:.1, maxval:40, warp:"linexp"});
      
      var audio  = T("audio", {isLooped:true});
      var filter = T("biquad", {type:"LPF", freq:mouseX, Q:mouseY}, audio);
      var wave   = T("wave", {size:512,interval:2500}).listen(filter);
      var fft    = T("fft", {interval:80}).listen(filter);
      
      audio.on("loadeddata", function() {
          filter.play();
      });
      
      var lastTime    = 0;
      var animationId = 0;
      function animate(time) {
          if (time - lastTime > 60) {
              lastTime = time;
              filter.plot({target:viewer,x:  0,width:160,height:80});
              wave.plot  ({target:viewer,x:160,width:160,height:80});
              fft.plot   ({target:viewer,x:320,width:160,height:80});
          }
          animationId = requestAnimationFrame(animate);

      }
      
      timbre.on("play", function() {
          animationId = requestAnimationFrame(animate);
      }).on("pause", function() {
          cancelAnimationFrame(animationId);
      }).amp = 0;
      
      audio.load("./misc/amen.wav");
    </script>
  </body>
</html>
